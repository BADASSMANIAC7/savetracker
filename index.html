<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Savings Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Base Variables */
    :root {
      --primary: #0288d1;
      --secondary: #2ecc71;
      --danger: #e74c3c;
      --text: #1a237e;
      --text-light: #78909c;
      --background: #e3f2fd;
      --card-bg: rgba(255, 255, 255, 0.7);
      --card-border: rgba(255, 255, 255, 0.2);
      --shadow: 0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --font-size-base: clamp(14px, 2vw, 16px);
      --spacing-unit: 1.5rem;
    }

    /* Dark Mode Variables */
    [data-theme="dark"] {
      --primary: #4fc3f7;
      --secondary: #66bb6a;
      --danger: #ef5350;
      --text: #e0f7fa;
      --text-light: #90a4ae;
      --background: #121212;
      --card-bg: rgba(33, 33, 33, 0.7);
      --card-border: rgba(66, 66, 66, 0.3);
      --shadow: 0 8px 24px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* Reset */
    .container * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--background), #b3e5fc);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--spacing-unit);
      font-size: var(--font-size-base);
      transition: var(--transition);
      overflow-x: hidden;
    }

    h1 {
      font-size: clamp(1.8rem, 5vw, 2.4rem);
      font-weight: 700;
      text-align: center;
      margin-bottom: calc(var(--spacing-unit) * 1.5);
      color: var(--primary);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1s ease-out;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Container */
    .container {
      max-width: 1200px;
      width: 100%;
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--card-border);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: calc(var(--spacing-unit) * 1.5);
      margin-bottom: calc(var(--spacing-unit) * 2);
      animation: fadeIn 0.8s ease-out;
      display: grid;
      gap: calc(var(--spacing-unit) * 1.2);
    }

    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      top: var(--spacing-unit);
      right: var(--spacing-unit);
      padding: 0.8rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.3rem;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: var(--transition);
      z-index: 1000;
    }

    .theme-toggle:hover, .theme-toggle:focus-visible {
      background: #0277bd;
      transform: rotate(90deg) scale(1.15);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      outline: none;
    }

    /* Form Styles */
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: calc(var(--spacing-unit) * 0.8);
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
      padding: var(--spacing-unit);
      border-radius: var(--border-radius);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);

      & input,
      & select,
      & button {
        padding: 0.7rem 1rem;
        font-size: var(--font-size-base);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.9);
        transition: var(--transition);
        outline: none;
      }

      & input:focus,
      & select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(2, 136, 209, 0.2);
      }

      & button {
        background: var(--secondary);
        color: white;
        border: none;
        font-weight: 600;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      & button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.4s, height 0.4s;
      }

      & button:hover::after, & button:focus-visible::after {
        width: 200px;
        height: 200px;
      }

      & button:hover, & button:focus-visible {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        outline: none;
      }

      & .form-error {
        color: var(--danger);
        font-size: 0.9rem;
        margin-top: 0.5rem;
        grid-column: 1 / -1;
        text-align: center;
        animation: fadeIn 0.3s ease-out;
      }
    }

    /* Table Styles */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);

      & th, & td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      & th {
        background: linear-gradient(90deg, var(--primary), #039be5);
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9rem;
      }

      & tbody tr {
        transition: var(--transition);
        animation: slideIn 0.5s ease-out;
      }

      & tbody tr:hover {
        background: rgba(2, 136, 209, 0.1);
        transform: scale(1.01);
      }
    }

    button.delete-btn {
      background: var(--danger);
      border: none;
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: var(--transition);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    button.delete-btn:hover, button.delete-btn:focus-visible {
      background: #c0392b;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      outline: none;
    }

    /* Goals */
    .goals {
      display: grid;
      gap: calc(var(--spacing-unit) * 1.2);

      & .goal {
        background: var(--card-bg);
        backdrop-filter: blur(12px);
        border: 1px solid var(--card-border);
        border-radius: var(--border-radius);
        padding: var(--spacing-unit);
        box-shadow: var(--shadow);
        animation: slideIn 0.6s ease-out;
        transition: transform 0.3s ease;

        &:hover {
          transform: translateY(-5px);
        }

        & h3 {
          font-size: clamp(1.1rem, 2.5vw, 1.25rem);
          font-weight: 600;
          color: var(--text);
          margin-bottom: 0.8rem;
        }

        & .progress-bar {
          background: rgba(0, 0, 0, 0.15);
          height: 24px;
          border-radius: 12px;
          overflow: hidden;
          position: relative;

          & .progress-bar-fill {
            height: 100%;
            width: 0;
            background: var(--secondary);
            border-radius: 12px 0 0 12px;
            transition: width 1.5s ease-in-out;
            position: relative;
            overflow: hidden;

            &::after {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
              );
              background-size: 20px 20px;
              animation: moveStripes 1.5s linear infinite;
            }
          }

          & .progress-bar-fill.milestone-25 { background: #f39c12; }
          & .progress-bar-fill.milestone-50 { background: #e67e22; }
          & .progress-bar-fill.milestone-75 { background: #d35400; }
          & .progress-bar-fill.milestone-100 { background: var(--secondary); }
        }

        & .progress-text {
          margin-top: 0.6rem;
          font-weight: 500;
          color: var(--text);
          font-size: 0.95rem;
        }

        & .goal-chart-container {
          max-width: 300px;
          margin: 1rem auto;
          padding: 0.8rem;
          background: var(--card-bg);
          border-radius: 8px;
          box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }
      }
    }

    @keyframes moveStripes {
      0% { background-position: 0 0; }
      100% { background-position: 40px 40px; }
    }

    /* Chart and Targets Layout */
    .charts-targets {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-unit);
      margin: calc(var(--spacing-unit) * 1.5) auto;
      max-width: 1200px;

      & .chart-container, & .targets-container {
        background: var(--card-bg);
        backdrop-filter: blur(12px);
        border: 1px solid var(--card-border);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        padding: var(--spacing-unit);
        animation: fadeIn 0.8s ease-out;
      }
    }

    .targets-container {
      display: grid;
      gap: calc(var(--spacing-unit) * 0.6);

      & h3 {
        font-size: clamp(1.1rem, 2.5vw, 1.25rem);
        font-weight: 600;
        color: var(--text);
        text-align: center;
        margin-bottom: 0.5rem;
      }

      & .target {
        padding: 0.8rem;
        border-radius: 8px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        font-size: 0.95rem;
        transition: var(--transition);

        &:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        & h4 {
          font-size: 1rem;
          font-weight: 600;
          margin-bottom: 0.5rem;
        }

        & .status-met {
          color: var(--secondary);
          font-weight: 600;
        }

        & .status-unmet {
          color: var(--danger);
          font-weight: 600;
        }
      }
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: calc(var(--spacing-unit) * 1.5);
      right: calc(var(--spacing-unit));
      background: linear-gradient(90deg, var(--secondary), #27ae60);
      color: white;
      padding: 0.8rem;
      1.2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px;
      rgba(0,0,0,0.2);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
      transform 0.5s;
      cubic ease-in-out;
      font-weight: 600;
      z-index: 1000;
      transform: translateY(30px);
      min-width: 220px;
      text-align: center;
    }

    .notification.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .charts-targets {
        grid-template-columns: 1fr;
      }

      .container {
        padding: var(--spacing-unit);
      }

      form {
        grid-template-columns: 1fr;
      }

      table {
        display: 100%;
        width;

        & thead {
          display: none;
        }

        & tbody,
        & tr,
        & td {
          display: block;
        }

        & tr {
          margin-bottom: calc(var(--spacing-unit) * 0.75);
          border-bottom-width: 1px solid rgba(0, 0,0.1);
          padding: 0.5rem;
        }

        & td {
          padding: 0.5rem;
          0.5rem;
          0.5rem;
          40%;
          position: relative;
        }

        & td:before {
          content: attr(data-label);
          position: absolute;
          left: 0.5rem;
          width: 35%;
          font-weight: bold;
          color: var(--text-light);
        }

        & td:nth-child(1) { data-label: "Date"; }
        & td:nth-child(2) { data-label: "Amount ($)"; }
        & td:nth-child(3) { data-label: "Goal"; }
        & td:nth-child(4) { data-label: "Category"; }
        & td:nth-child(5) { data-label: "Notes"; }
        & td:nth-child(6) { data-label="Action"; text-align: center; }
      }

      .goal .goal-chart-container {
        max-width: 100%;
      }
    @media screen (max-width: 480px) {
      h1 {
        font-size: clamp(1.4rem, 4vw, 1.8rem);
      }

      .notification {
        font-size: 0.85rem;
        min-width: 180px;
      }

      .theme-toggle {
        font-size: 1.1rem;
        width: 40px;
        height: 40px;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
  <h1>Savings Tracker</h1>
  <div class="container">
    <form id="entry-form" aria-labelledby="entry-form-title">
      <h2 id="entry-form-title" style="display: none;">Add Savings Entry</h2>
      <input type="date" id="entry-date" aria-label="Entry date" required />
      <input type="entry-amount" id="entry-amount" min="0.01" step="0.01" placeholder="Amount" aria-label="Savings amount" required />
      <select id="entry-goal" aria-label="Associated goal" required>
        <option value="" disabled selected>Select Goal</option>
        <option value="General">General</option>
      </select>
      <select id="entry-category" aria-label="Savings category" required>
        <option value="" disabled selected>Category</option>
        <option>Emergency Fund</option>
        <option value="Vacation">Vacation</option>
        <option value="Education">Education</option>
        <option value="Retirement">Retirement</option>
        <option value="Other">Other</option>
      </select>
      <input type="text" id="entry-notes" placeholder="Notes" aria-label="Notes" />
      <button type="submit">Add Saving</button>
    </form>

    <table aria-label="Savings entries">
      <thead>
        <tr>
          <th>Date</th>
          <th>Amount ($)</th>
          <th>Goal</th>
          <th>Category</th>
          <th>Notes</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="entries-tbody"></tbody>
    </table>

    <form id="goal-form" aria-labelledby="goal-form-title">
      <h2 id="goal-form-title" style="display: none;">Add Savings Goal</h2>
      <input type="text" id="goal-name" placeholder="Goal Name" aria-label="Goal name" required />
      <input type="number" id="goal-target" min="0.01" step="0.01" placeholder="Target Amount" aria-label="Target amount" required />
      <input type="date" id="goal-deadline" aria-label="Goal deadline" required />
      <button type="submit">Add Goal</button>
    </form>

    <div class="goals" id="goals-container"></div>

    <div class="charts-targets">
      <div class="chart-container">
        <canvas id="general-savings-chart" aria-label="General savings distribution by category"></canvas>
      </div>
      <div class="targets-container" id="targets-container" aria-live="polite">
        <h3>Savings Targets</h3>
        <div id="targets-list"></div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification" role="alert" aria-live="assertive"></div>

  <script>
    const STORAGE_KEYS = {
      entries: 'savingTrackerEntries',
      goals: 'savingTrackerGoals',
      theme: 'savingTrackerTheme'
    };

    const entryForm = document.getElementById('entry-form');
    const entriesTbody = document.getElementById('entries-tbody');
    const goalForm = document.getElementById('goal-form');
    const goalsContainer = document.getElementById('goals-container');
    const targetsList = document.getElementById('targets-list');
    const notificationEl = document.getElementById('notification');
    const themeToggle = document.querySelector('.theme-toggle');
    const goalSelect = document.getElementById('entry-goal');
    let charts = {};

    function loadData(key, defaultValue) {
      try {
        const data = JSON.parse(localStorage.getItem(key));
        return data && Array.isArray(data) ? data : defaultValue;
      } catch (e) {
        console.error(`Error loading ${key}:`, e);
        return defaultValue;
      }
    }

    let entries = loadData(STORAGE_KEYS.entries, []);
    let goals = loadData(STORAGE_KEYS.goals, []);

    const savedTheme = localStorage.getItem(STORAGE_KEYS.theme) || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';

    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem(STORAGE_KEYS.theme, newTheme);
      themeToggle.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
      showNotification(`Switched to ${newTheme} mode`);
      updateCharts();
    });

    function saveData() {
      localStorage.setItem(STORAGE_KEYS.entries, JSON.stringify(entries));
      localStorage.setItem(STORAGE_KEYS.goals, JSON.stringify(goals));
    }

    function formatDate(dateStr) {
      if (!dateStr) return 'Invalid Date';
      const d = new Date(dateStr);
      return isNaN(d.getTime()) ? 'Invalid Date' : d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function showNotification(message) {
      notificationEl.textContent = message;
      notificationEl.classList.add('show');
      setTimeout(() => notificationEl.classList.remove('show'), 3000);
    }

    function showFormError(message, formId) {
      const existingError = document.querySelector(`#${formId} .form-error`);
      if (existingError) existingError.remove();
      const errorEl = document.createElement('div');
      errorEl.className = 'form-error';
      errorEl.textContent = message;
      document.getElementById(formId).appendChild(errorEl);
      setTimeout(() => errorEl.remove(), 3000);
    }

    function getWeekStartEnd(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day + (day === 0 ? -6 : 1);
      const start = new Date(d.setDate(diff));
      start.setHours(0, 0, 0, 0);
      const end = new Date(start);
      end.setDate(start.getDate() + 6);
      end.setHours(23, 59, 59, 999);
      return { start, end };
    }

    function getMonthStartEnd(date) {
      const d = new Date(date);
      const start = new Date(d.getFullYear(), d.getMonth(), 1);
      start.setHours(0, 0, 0, 0);
      const end = new Date(d.getFullYear(), d.getMonth() + 1, 0);
      end.setHours(23, 59, 59, 999);
      return { start, end };
    }

    function calculateWeeksUntil(deadline) {
      const now = new Date();
      const target = new Date(deadline);
      if (target < now) return 0;
      const diffDays = Math.floor((target - now) / (1000 * 60 * 60 * 24));
      return Math.max(1, Math.ceil(diffDays / 7));
    }

    function calculateMonthsUntil(deadline) {
      const now = new Date();
      const target = new Date(deadline);
      if (target < now) return 0;
      const yearsDiff = target.getFullYear() - now.getFullYear();
      const monthsDiff = target.getMonth() - now.getMonth();
      return Math.max(1, yearsDiff * 12 + monthsDiff);
    }

    function calculateSavingsForGoal(goalId) {
      return entries
        .filter(e => e.goalId === goalId)
        .reduce((sum, e) => sum + e.amount, 0);
    }

    function calculateWeeklySavings(goal) {
      const now = new Date();
      const { start, end } = getWeekStartEnd(now);
      return entries
        .filter(e => e.goalId === goal.id && new Date(e.date) >= start && new Date(e.date) <= end)
        .reduce((sum, e) => sum + e.amount, 0);
    }

    function calculateMonthlySavings(goal) {
      const now = new Date();
      const { start, end } = getMonthStartEnd(now);
      return entries
        .filter(e => e.goalId === goal.id && new Date(e.date) >= start && new Date(e.date) <= end)
        .reduce((sum, e) => sum + e.amount, 0);
    }

    function calculateTargets(goal) {
      const saved = calculateSavingsForGoal(goal.id);
      const remaining = goal.target - saved;
      if (remaining <= 0) return { weekly: 0, monthly: 0 };

      const weeksLeft = calculateWeeksUntil(goal.deadline);
      const monthsLeft = calculateMonthsUntil(goal.deadline);

      return {
        weekly: remaining / weeksLeft,
        monthly: remaining / monthsLeft
      };
    }

    function updateSavingsTargets() {
      targetsList.innerHTML = '';
      if (!goals.length) {
        targetsList.innerHTML = '<p style="color: var(--text-light); text-align: center;">No savings targets.</p>';
        return;
      }

      goals.forEach(goal => {
        const targets = calculateTargets(goal);
        const weeklySaved = calculateWeeklySavings(goal);
        const monthlySaved = calculateMonthlySavings(goal);
        const weeklyRemaining = targets.weekly - weeklySaved;
        const monthlyRemaining = targets.monthly - monthlySaved;

        const targetEl = document.createElement('div');
        targetEl.className = 'target';
        targetEl.innerHTML = `
          <h4>${goal.name}</h4>
          <div>
            Weekly Target: $${targets.weekly.toFixed(2)}<br>
            Saved: $${weeklySaved.toFixed(2)}<br>
            <span class="${weeklyRemaining <= 0 ? 'status-met' : 'status-unmet'}">
              ${weeklyRemaining <= 0 ? 'Weekly target met!' : `Need $${weeklyRemaining.toFixed(2)} more`}
            </span>
          </div>
          <div>
            Monthly Target: $${targets.monthly.toFixed(2)}<br>
            Saved: $${monthlySaved.toFixed(2)}<br>
            <span class="${monthlyRemaining <= 0 ? 'status-met' : 'status-unmet'}">
              ${monthlyRemaining <= 0 ? 'Monthly target met!' : `Need $${monthlyRemaining.toFixed(2)} more`}
            </span>
          </div>
        `;
        targetsList.appendChild(targetEl);

        if (weeklyRemaining > 0) {
          showNotification(`For ${goal.name}: Need $${weeklyRemaining.toFixed(2)} more this week!`);
        }
        if (monthlyRemaining > 0) {
          showNotification(`For ${goal.name}: Need $${monthlyRemaining.toFixed(2)} more this month!`);
        }
      });
    }

    function updateCharts() {
      // Destroy existing charts
      Object.values(charts).forEach(chart => chart.destroy());
      charts = {};

      // General savings chart
      const generalCtx = document.getElementById('general-savings-chart').getContext('2d');
      const generalEntries = entries.filter(e => e.goalId === 'General');
      charts['general'] = createChart(generalCtx, generalEntries, 'General Savings by Category');

      // Goal-specific charts
      goals.forEach(goal => {
        const canvas = document.getElementById(`goal-chart-${goal.id}`);
        if (canvas) {
          const ctx = canvas.getContext('2d');
          const goalEntries = entries.filter(e => e.goalId === goal.id);
          charts[goal.id] = createChart(ctx, goalEntries, `${goal.name} Savings by Category`);
        }
      });
    }

    function createChart(ctx, entries, title) {
      const categorySums = entries.reduce((acc, entry) => {
        acc[entry.category] = (acc[entry.category] || 0) + entry.amount;
        return acc;
      }, {});

      const labels = Object.keys(categorySums);
      const data = Object.values(categorySums);
      const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
      const colors = isDarkMode
        ? ['#4fc3f7', '#66bb6a', '#ffca28', '#ab47bc', '#ff7043']
        : ['#0288d1', '#2ecc71', '#fbc02d', '#8e24aa', '#f4511e'];

      return new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels.length ? labels : ['No Data'],
          datasets: [{
            data: data.length ? data : [1],
            backgroundColor: data.length ? colors : ['#ccc'],
            borderColor: isDarkMode ? '#333' : '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: isDarkMode ? '#e0f7fa' : '#1a237e',
                font: { size: 12 }
              }
            },
            title: {
              display: true,
              text: title,
              color: isDarkMode ? '#e0f7fa' : '#1a237e',
              font: { size: 14 }
            }
          }
        }
      });
    }

    function updateGoalSelect() {
      goalSelect.innerHTML = `
        <option value="" disabled selected>Select Goal</option>
        <option value="General">General</option>
        ${goals.map(goal => `<option value="${goal.id}">${goal.name}</option>`).join('')}
      `;
    }

    function renderEntries() {
      entriesTbody.innerHTML = '';

      if (!entries.length) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="6" style="text-align: center; color: var(--text-light);">No savings added yet.</td>`;
        entriesTbody.appendChild(tr);
        return;
      }

      entries.sort((a, b) => new Date(b.date) - new Date(a.date));

      entries.forEach(entry => {
        const goalName = entry.goalId === 'General' ? 'General' : (goals.find(g => g.id === entry.goalId)?.name || 'General');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="Date">${formatDate(entry.date)}</td>
          <td data-label="Amount ($)">${entry.amount.toFixed(2)}</td>
          <td data-label="Goal">${goalName}</td>
          <td data-label="Category">${entry.category}</td>
          <td data-label="Notes">${entry.notes || '-'}</td>
          <td data-label="Action"><button class="delete-btn" data-id="${entry.id}" aria-label="Delete entry">Delete</button></td>
        `;
        entriesTbody.appendChild(tr);
      });

      updateCharts();
      updateSavingsTargets();
    }

    function addEntry(date, amount, goalId, category, notes) {
      entries.push({
        id: Date.now().toString(),
        date,
        amount: parseFloat(amount),
        goalId,
        category,
        notes
      });
      saveData();
      renderEntries();
      updateGoalsProgress();
      showNotification('Saving added!');
    }

    function deleteEntry(id) {
      entries = entries.filter(e => e.id !== id);
      saveData();
      renderEntries();
      updateGoalsProgress();
      updateSavingsTargets();
      showNotification('Saving deleted!');
    }

    function renderGoals() {
      goalsContainer.innerHTML = '';

      if (!goals.length) {
        goalsContainer.innerHTML = '<p style="color: var(--text-light); font-style: italic;">No goals yet. Add one above.</p>';
        return;
      }

      goals.forEach(goal => {
        const totalSaved = calculateSavingsForGoal(goal.id);
        const progressPercent = Math.min((totalSaved / goal.target) * 100, 100);

        const goalEl = document.createElement('div');
        goalEl.classList.add('goal');
        goalEl.innerHTML = `
          <h3>${goal.name}</h3>
          <div class="progress-bar" aria-label="Progress toward goal ${goal.name}">
            <div class="progress-bar-fill" style="width: 0;" role="progressbar" aria-valuenow="${progressPercent}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <div class="progress-text">$${totalSaved.toFixed(2)} saved of $${goal.target.toFixed(2)} (${progressPercent.toFixed(1)}%)</div>
          <div>Deadline: ${formatDate(goal.deadline)}</div>
          <div class="goal-chart-container">
            <canvas id="goal-chart-${goal.id}" aria-label="${goal.name} savings distribution by category"></canvas>
          </div>
          <button class="delete-btn" data-id="${goal.id}" aria-label="Delete goal">Delete Goal</button>
        `;
        goalsContainer.appendChild(goalEl);

        const progressBarFill = goalEl.querySelector('.progress-bar-fill');
        animateProgressBar(progressBarFill, progressPercent, goal);
      });

      updateGoalSelect();
      updateCharts();
      updateSavingsTargets();
    }

    function addGoal(name, target, deadline) {
      goals.push({
        id: Date.now().toString(),
        name,
        target: parseFloat(target),
        deadline
      });
      saveData();
      renderGoals();
      showNotification('Goal added!');
    }

    function deleteGoal(id) {
      entries = entries.filter(e => e.goalId !== id);
      goals = goals.filter(g => g.id !== id);
      saveData();
      renderEntries();
      renderGoals();
      showNotification('Goal deleted!');
    }

    function animateProgressBar(bar, percent, goal) {
      bar.style.width = '0%';
      bar.className = 'progress-bar-fill';

      let milestoneReached = null;
      if (percent >= 100) {
        bar.classList.add('milestone-100');
        milestoneReached = '100% â€” Goal Achieved!';
      } else if (percent >= 75) {
        bar.classList.add('milestone-75');
        milestoneReached = '75% Milestone reached!';
      } else if (percent >= 50) {
        bar.classList.add('milestone-50');
        milestoneReached = '50% Milestone reached!';
      } else if (percent >= 25) {
        bar.classList.add('milestone-25');
        milestoneReached = '25% Milestone reached!';
      }

      requestAnimationFrame(() => {
        bar.style.width = percent + '%';
      });

      if (milestoneReached) {
        const lastMilestoneKey = `milestone_${goal.id}`;
        const lastMilestone = sessionStorage.getItem(lastMilestoneKey) || '0';
        const levels = { '0': 0, '25': 25, '50': 50, '75': 75, '100': 100 };
        const milestoneLevel = Object.keys(levels).find(k => milestoneReached.includes(k));

        if (levels[milestoneLevel] > levels[lastMilestone]) {
          sessionStorage.setItem(lastMilestoneKey, milestoneLevel);
          showNotification(`${goal.name}: ${milestoneReached}`);
        }
      }
    }

    function updateGoalsProgress() {
      renderGoals();
    }

    entryForm.addEventListener('submit', e => {
      e.preventDefault();
      const date = document.getElementById('entry-date').value;
      const amount = document.getElementById('entry-amount').value;
      const goalId = document.getElementById('entry-goal').value;
      const category = document.getElementById('entry-category').value;
      const notes = document.getElementById('entry-notes').value;

      if (!date || !amount || !goalId || !category) {
        showFormError('Please fill out date, amount, goal, and category.', 'entry-form');
        return;
      }
      if (parseFloat(amount) <= 0) {
        showFormError('Amount must be positive.', 'entry-form');
        return;
      }

      addEntry(date, amount, goalId, category, notes);
      entryForm.reset();
    });

    entriesTbody.addEventListener('click', e => {
      if (e.target.classList.contains('delete-btn')) {
        const id = e.target.dataset.id;
        if (confirm('Are you sure you want to delete this saving entry?')) {
          deleteEntry(id);
        }
      }
    });

    goalForm.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('goal-name').value.trim();
      const target = document.getElementById('goal-target').value;
      const deadline = document.getElementById('goal-deadline').value;

      if (!name || !target || !deadline) {
        showFormError('Please fill out all goal fields.', 'goal-form');
        return;
      }
      if (parseFloat(target) <= 0) {
        showFormError('Target amount must be positive.', 'goal-form');
        return;
      }
      const today = new Date().setHours(0, 0, 0, 0);
      const deadlineDate = new Date(deadline).setHours(0, 0, 0, 0);
      if (deadlineDate < today) {
        showFormError('Deadline must be in the future.', 'goal-form');
        return;
      }

      addGoal(name, target, deadline);
      goalForm.reset();
    });

    goalsContainer.addEventListener('click', e => {
      if (e.target.classList.contains('delete-btn')) {
        const id = e.target.dataset.id;
        if (confirm('Are you sure you want to delete this goal and its associated savings?')) {
          deleteGoal(id);
        }
      }
    });

    renderEntries();
    renderGoals();
    updateCharts();
    updateSavingsTargets();
  </script>
</body>
</html>